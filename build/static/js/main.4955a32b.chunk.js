(this.webpackJsonpwebrtc=this.webpackJsonpwebrtc||[]).push([[0],{105:function(e,t,n){e.exports=n.p+"static/media/video-bg.56248c52.jpg"},107:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),r=n(27),i=n.n(r),c=(n(70),n(17)),s=n(8),l=n(18),d=n(19),u=n(21),m=n(16),f=n(9),p=n(57),v=n.n(p);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).mutemic=function(e){var t=n.video.srcObject.getTracks().filter((function(e){return"audio"===e.kind}));n.setState((function(e){return t&&(t[0].enabled=!e.mic),{mic:!e.mic}}))},n.mutecamera=function(e){var t=n.video.srcObject.getTracks().filter((function(e){return"video"===e.kind}));n.setState((function(e){return t&&(t[0].enabled=!e.camera),{camera:!e.camera}}))},n.state={mic:!0,camera:!0,videoVisible:!0},n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.props.videoStream&&(this.video.srcObject=this.props.videoStream)}},{key:"componentWillReceiveProps",value:function(e){var t=this;console.log("1",this.props.videoType,e.videoStream),e.videoStream&&e.videoStream!==this.props.videoStream&&(console.log("2",this.props.videoType,e.videoStream),this.video.srcObject=e.videoStream);var n=e.videoStream&&e.videoStream.getVideoTracks();"remoteVideo"===this.props.videoType&&n&&n.length&&(n[0].onmute=function(){t.setState({videoVisible:!1}),t.props.videoMuted(e.videoStream)},n[0].onunmute=function(){t.setState({videoVisible:!0}),t.props.videoMuted(e.videoStream)});var o=e.videoStream&&e.videoStream.getAudioTracks();"remoteVideo"===this.props.videoType&&o&&o.length&&(o[0].onmute=function(){alert("muted")})}},{key:"render",value:function(){var e=this,t=this.props.showMuteControls&&a.a.createElement("div",null,a.a.createElement("i",{onClick:this.mutemic,style:{cursor:"pointer",padding:5,fontSize:20,color:this.state.mic?"white":"red"},class:"material-icons"},this.state.mic?"mic":"mic_off"),a.a.createElement("i",{onClick:this.mutecamera,style:{cursor:"pointer",padding:5,fontSize:20,color:this.state.camera?"white":"red"},class:"material-icons"},this.state.camera?"videocam":"videocam_off"));return a.a.createElement("div",{style:g({},this.props.frameStyle)},a.a.createElement("video",{id:this.props.id,muted:this.props.muted,autoPlay:!0,style:g({visibility:this.state.videoVisible?"visible":"hidden"},this.props.videoStyles),ref:function(t){e.video=t}}),t)}}]),t}(o.Component);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var S=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).videoMuted=function(e){var t=e.getVideoTracks()[0];e.id===n.state.selectedVideo.stream.id&&n.setState({videoVisible:!t.muted})},n.switchVideo=function(e){var t=e.stream.getVideoTracks()[0];n.setState({selectedVideo:e,videoVisible:!t.muted})},n.state={rVideos:[],remoteStreams:[],selectedVideo:null,videoVisible:!1},n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;if(this.props.remoteStreams!==e.remoteStreams){var n=e.remoteStreams.length,o={};o=1===n?{selectedVideo:e.remoteStreams[0]}:(o=this.state.selectedVideo&&e.remoteStreams.filter((function(e){return e.id===t.state.selectedVideo.id}))||[]).length?{}:{selectedVideo:e.remoteStreams[n-1]};var r=e.remoteStreams.map((function(e,n){var o=e.stream.getTracks().filter((function(e){return"video"===e.kind}))&&a.a.createElement(b,{videoMuted:t.videoMuted,videoType:"remoteVideo",videoStream:e.stream,frameStyle:{backgroundColor:"#ffffff12",maxWidth:120,maxHeight:120,borderRadius:5,float:"left",margin:"0 3px"},videoStyles:{objectFit:"cover",borderRadius:5,width:120,height:120,maxWidth:120,maxHeight:120}})||a.a.createElement("div",null);return a.a.createElement("div",{id:e.name,onClick:function(){return t.switchVideo(e)},style:{cursor:"pointer",display:"inline-block"},key:n},o)}));this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({remoteStreams:e.remoteStreams,rVideos:r},o))}}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(b,{videoType:"previewVideo",frameStyle:{zIndex:1,position:"fixed",bottom:0,minWidth:"100%",minHeight:"100%",backgroundColor:"black"},videoStyles:{minWidth:"100%",minHeight:"100%",visibility:this.state.videoVisible?"visible":"hidden"},videoStream:this.state.selectedVideo&&this.state.selectedVideo.stream}),a.a.createElement("div",{style:{backgroundColor:"rgba(0,0,0,0.3)",top:"auto",right:10,left:10,bottom:10,overflowX:"scroll",whiteSpace:"nowrap"}},this.state.rVideos))}}]),t}(o.Component),O=n(13),k=function(e){var t=Object(o.useState)("transparent"),n=Object(O.a)(t,2),r=n[0],i=n[1],c=function(e){console.log(e),i(e?"green":"transparent")};return a.a.createElement("div",{style:{backgroundColor:r},className:e.className,onDragEnter:function(e){e.preventDefault(),e.stopPropagation(),c(!0),e.dataTransfer.dropEffect="copy",console.log("DragEnter",e.dataTransfer.items.length)},onDragLeave:function(e){e.preventDefault(),e.stopPropagation(),c(!1),console.log("onDragLeave")},onDragOver:function(e){e.preventDefault(),e.stopPropagation(),console.log("onDragOver")},onDrop:function(t){t.preventDefault(),t.stopPropagation(),c(!1),console.log(t.dataTransfer.items),t.dataTransfer.files&&t.dataTransfer.files.length>0&&e.sendFiles(t.dataTransfer.files)}},e.children)},j=function(e){var t=Object(o.useState)(""),n=Object(O.a)(t,2),r=n[0],i=n[1],c=Object(o.useState)({uid:0}),s=Object(O.a)(c,2),l=s[0],d=s[1],u=Object(o.useState)(!1),m=Object(O.a)(u,2),f=m[0],p=m[1],v=Object(o.useState)(""),h=Object(O.a)(v,2),g=h[0],b=h[1],y=function(){var e=document.getElementById("chatList");e.scrollTop=e.scrollHeight};Object(o.useEffect)((function(){y(),d({uid:e.user.uid})}),[e]);var S,j=function(t){e.sendMessage(t),y()},w=function(e,t){console.log("===========",t);var n=t.message,o="text"===t.type&&a.a.createElement("div",{className:"msg"},a.a.createElement("p",null,n.sender.uid),a.a.createElement("div",{className:"message"}," ",n.data.text))||a.a.createElement("div",{className:"msg"},a.a.createElement("p",null,n.sender.uid),a.a.createElement("img",{onClick:function(){p(!0),b(n.data)},className:"message",style:{width:200,cursor:"pointer"},src:n.data}));return a.a.createElement("li",{className:e},o)};return a.a.createElement("div",null,f&&(S=g,a.a.createElement("img",{src:S,style:{backgroundColor:"black",position:"relative",zIndex:100,display:"block",cursor:"pointer",marginLeft:"auto",marginRight:"auto",padding:20,borderRadius:20},onClick:function(){return p(!1)}})),a.a.createElement("div",{className:"chatWindow",style:{zIndex:10,position:"absolute",right:5,top:190,bottom:140,width:350}},a.a.createElement("ul",{className:"chat",id:"chatList"},e.messages.map((function(e){return a.a.createElement("div",{key:e.id},l.uid===e.message.sender.uid?w("self",e):w("other",e))}))),a.a.createElement(k,{className:"chatInputWrapper",sendFiles:function(e){var t=new FileReader;t.onload=function(e){e.target.result.length<=262118?j({type:"image",message:{id:l.uid,sender:{uid:l.uid},data:e.target.result}}):alert("Message exceeds Maximum Message Size!")},t.readAsDataURL(e[0])}},a.a.createElement("div",null,a.a.createElement("form",{onSubmit:function(e){""!==r&&(e.preventDefault(),j({type:"text",message:{id:l.uid,sender:{uid:l.uid},data:{text:r}}}),i(""))}},a.a.createElement("input",{className:"textarea input",type:"text",placeholder:"Enter your message...",onChange:function(e){i(e.target.value)},value:r}))))))},w=function(e){var t=Object(o.useState)(!1),n=Object(O.a)(t,2),r=n[0],i=n[1],c=Object(o.useState)({x:0,y:0}),s=Object(O.a)(c,2),l=s[0],d=s[1],u=Object(o.useRef)();Object(o.useEffect)((function(){u.current&&(u.current.style.transform="translate(".concat(l.x,"px, ").concat(l.y,"px)"))}),[l]);return a.a.createElement("div",{style:e.style,ref:u,onMouseMove:function(e){r&&d({x:l.x+e.movementX,y:l.y+e.movementY})},onMouseDown:function(){return i(!0)},onMouseUp:function(){return i(!1)}},e.children)},E=n(58),C=n.n(E),P=n(122);function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var V=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).getLocalStream=function(){navigator.mediaDevices.getUserMedia({audio:!0,video:!0,options:{mirror:!0}}).then((function(e){window.localStream=e,n.setState({localStream:e}),n.whoisOnline()})).catch((function(e){console.log("getUserMedia Error: ",e)}))},n.whoisOnline=function(){n.sendToPeer("onlinePeers",null,{local:n.socket.id})},n.sendToPeer=function(e,t,o){n.socket.emit(e,{socketID:o,payload:t})},n.createPeerConnection=function(e,t){try{var o=new RTCPeerConnection(n.state.pc_config),a=T({},n.state.peerConnections,Object(f.a)({},e,o));n.setState({peerConnections:a}),o.onicecandidate=function(t){t.candidate&&n.sendToPeer("candidate",t.candidate,{local:n.socket.id,remote:e})},o.oniceconnectionstatechange=function(e){},o.ontrack=function(t){var o=null,a=n.state.remoteStreams,r={},i=n.state.remoteStreams.filter((function(t){return t.id===e}));i.length?((o=i[0].stream).addTrack(t.track,o),r=T({},i[0],{stream:o}),a=n.state.remoteStreams.map((function(e){return e.id===r.id&&r||e}))):((o=new MediaStream).addTrack(t.track,o),r={id:e,name:e,stream:o},a=[].concat(Object(m.a)(n.state.remoteStreams),[r])),n.setState((function(e){var t=e.remoteStreams.length>0?{}:{remoteStream:o},n=e.remoteStreams.filter((function(t){return t.id===e.selectedVideo.id}));return T({},n=n.length?{}:{selectedVideo:r},{},t,{remoteStreams:a})}))},o.close=function(){console.log("pc closed")},n.state.localStream&&n.state.localStream.getTracks().forEach((function(e){o.addTrack(e,n.state.localStream)})),t(o)}catch(r){console.log("Something went wrong! pc not created!!",r),t(null)}},n.componentDidMount=function(){n.socket=v.a.connect(n.serviceIP,{path:"/io/webrtc",query:{room:window.location.pathname}}),n.socket.on("connection-success",(function(e){n.getLocalStream();var t=e.peerCount>1?"Two peers are connected":"Waiting for other peers to connect";n.setState({status:t,messages:e.messages})})),n.socket.on("joined-peers",(function(e){n.setState({status:e.peerCount>1?"Two peers are connected":"Waiting for other peers to connect"})})),n.socket.on("peer-disconnected",(function(e){n.state.peerConnections[e.socketID].close();var t=n.state.remoteStreams.filter((function(t){return t.id===e.socketID}));t&&n.stopTracks(t[0].stream);var o=n.state.remoteStreams.filter((function(t){return t.id!==e.socketID}));n.setState((function(t){var n=t.selectedVideo.id===e.socketID&&o.length?{selectedVideo:o[0]}:null;return T({remoteStreams:o},n,{status:e.peerCount>1?"Two peers are connected":"Waiting for other peers to connect"})}))})),n.socket.on("online-peer",(function(e){n.createPeerConnection(e,(function(t){if(t){var o=function(e){console.log("send channel status: "+n.state.sendChannels[0].readyState)},a=t.createDataChannel("sendChannel");a.onopen=o,a.onclose=o,n.setState((function(e){return{sendChannels:[].concat(Object(m.a)(e.sendChannels),[a])}}));var r=function(e){var t=JSON.parse(e.data);n.setState((function(e){return{messages:[].concat(Object(m.a)(e.messages),[t])}}))},i=function(e){n.receiveChannel&&console.log("receive channel's status has changed to "+n.receiveChannel.readyState)};t.ondatachannel=function(e){var t=e.channel;t.onmessage=r,t.onopen=i,t.onclose=i},t.createOffer(n.state.sdpConstraints).then((function(o){t.setLocalDescription(o),n.sendToPeer("offer",o,{local:n.socket.id,remote:e})}))}}))})),n.socket.on("offer",(function(e){n.createPeerConnection(e.socketID,(function(t){t.addStream(n.state.localStream);var o=function(e){console.log("send channel status: "+n.state.sendChannels[0].readyState)},a=t.createDataChannel("sendChannel");a.onopen=o,a.onclose=o,n.setState((function(e){return{sendChannels:[].concat(Object(m.a)(e.sendChannels),[a])}}));var r=function(e){var t=JSON.parse(e.data);n.setState((function(e){return{messages:[].concat(Object(m.a)(e.messages),[t])}}))},i=function(e){n.receiveChannel&&console.log("receive channel's status has changed to "+n.receiveChannel.readyState)};t.ondatachannel=function(e){var t=e.channel;t.onmessage=r,t.onopen=i,t.onclose=i},t.setRemoteDescription(new RTCSessionDescription(e.sdp)).then((function(){t.createAnswer(n.state.sdpConstraints).then((function(o){t.setLocalDescription(o),n.sendToPeer("answer",o,{local:n.socket.id,remote:e.socketID})}))}))}))})),n.socket.on("answer",(function(e){n.state.peerConnections[e.socketID].setRemoteDescription(new RTCSessionDescription(e.sdp)).then((function(){}))})),n.socket.on("candidate",(function(e){var t=n.state.peerConnections[e.socketID];t&&t.addIceCandidate(new RTCIceCandidate(e.candidate))}))},n.disconnectSocket=function(e){n.sendToPeer("socket-to-disconnect",null,{local:n.socket.id,remote:e})},n.mutecamera=function(e){var t=n.video.srcObject.getTracks().filter((function(e){return"video"===e.kind}));n.setState((function(e){return t&&(t[0].enabled=!e.camera),{camera:!e.camera}}))},n.switchVideo=function(e){n.setState({selectedVideo:e})},n.stopTracks=function(e){e.getTracks().forEach((function(e){return e.stop()}))},n.state={localStream:null,remoteStream:null,remoteStreams:[],peerConnections:{},selectedVideo:null,status:"Please wait...",pc_config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},sdpConstraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},messages:[],sendChannels:[],disconnected:!1},n.serviceIP="/webrtcPeer",n.socket=null,n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.status,o=t.messages,r=t.disconnected,i=t.localStream,c=t.peerConnections,s=t.remoteStreams;if(r)return this.socket.close(),this.stopTracks(i),s.forEach((function(t){return e.stopTracks(t.stream)})),c&&Object.values(c).forEach((function(e){return e.close()})),this.props.history.push("/"),a.a.createElement("div",null,"You have successfully Disconnected");var l=a.a.createElement("div",{style:{color:"yellow",padding:5}},n);return a.a.createElement("div",null,a.a.createElement(w,{style:{zIndex:101,position:"absolute",right:0,cursor:"move"}},a.a.createElement(b,{videoType:"localVideo",videoStyles:{width:200},frameStyle:{width:200,margin:5,borderRadius:5,backgroundColor:"black"},showMuteControls:!0,videoStream:i,autoPlay:!0,muted:!0})),a.a.createElement("br",null),a.a.createElement("div",{style:{zIndex:3,position:"absolute"}},a.a.createElement("div",{style:{margin:10,backgroundColor:"#cdc4ff4f",padding:10,borderRadius:5}},l)),a.a.createElement("div",{style:{zIndex:2,margin:10,backgroundColor:"white",padding:10,borderRadius:50,position:"absolute",bottom:0,left:"45%"}},a.a.createElement(P.a,{onClick:function(t){e.setState({disconnected:!0}),window.confirm("Are you sure want to END CALL ? ")&&(e.mutecamera(t),e.setState({disconnected:!0}))}},a.a.createElement(C.a,{style:{color:"red",fontSize:"36px"}}))),a.a.createElement("div",null,a.a.createElement(S,{switchVideo:this.switchVideo,remoteStreams:s})),a.a.createElement("br",null),a.a.createElement(j,{user:{uid:this.socket&&this.socket.id||""},messages:o,sendMessage:function(t){e.setState((function(e){return{messages:[].concat(Object(m.a)(e.messages),[t])}})),e.state.sendChannels.map((function(e){"open"===e.readyState&&e.send(JSON.stringify(t))})),e.sendToPeer("new-message",JSON.stringify(t),{local:e.socket.id})}}))}}]),t}(o.Component),x=n(123),I=n(59),M=n.n(I),R=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).on_click=function(){n.props.history.push("/home")},n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("div",null,a.a.createElement("div",{style:Object(f.a)({overflow:"hidden",backgroundColor:"black",position:"fixed",top:0,width:"100%"},"overflow","auto")},a.a.createElement("h2",{style:{color:"white",marginLeft:30,margin:"14px"}},"P2P VIDEO CALL")),a.a.createElement("div",null,a.a.createElement("img",{style:{width:"100vw",height:"100vh",backgroundSize:"100% 100%",backgroundRepeat:"no-repeat",position:"static"},src:n(105),alt:"pic"}))),a.a.createElement("div",{style:{position:"absolute",bottom:30,left:"40%"}},a.a.createElement(x.a,{style:{fontSize:"20px"},variant:"contained",color:"primary",size:"large",startIcon:a.a.createElement(M.a,null),onClick:this.on_click},"Start Video Call")))}}]),t}(o.Component),N=n(60),L=n(3),z=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).state={},n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(N.a,null,a.a.createElement(L.c,null,a.a.createElement(L.a,{exact:!0,path:"/",component:R}),a.a.createElement(L.a,{exact:!0,path:"/home",component:V}))))}}]),t}(o.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},65:function(e,t,n){e.exports=n(107)},70:function(e,t,n){},98:function(e,t){}},[[65,1,2]]]);
//# sourceMappingURL=main.4955a32b.chunk.js.map